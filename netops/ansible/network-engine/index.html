<!DOCTYPE html>
<html>
  <head>
    <title>overloaded bits</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="revised" content="2019-09-06T14:00:39 DST">
<title>Network-engine module :: overloaded bits</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/theme-flex/style.css" rel="stylesheet">

	<link href="/theme-flex/variant-gold.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "\/";
</script>
<meta name="description" content="Ansible network-engine module">



    
  </head>
  <body data-url="/netops/ansible/network-engine/">
    
      <header>
  <div class="logo">
    
	
  
    <a class="baselink" href="/">overloaded bits</a>
  


  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
    <nav class="shortcuts">
            <li class="" role="">
                <a href="https://github.com/ferfemar"  rel="noopener">
                  <i class='fa fa-github'></i> <label>Github repo</label>
                </a>
            </li>
    </nav>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/" class="dd-item">
          <a href="/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/ipspace-course-notes/" class="dd-item haschildren
        ">
      <div>
      <a href="/ipspace-course-notes/">Building Network Automation Solutions Course Notes</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/ipspace-course-notes/watch-list/" class="dd-item">
        <div>
          <a href="/ipspace-course-notes/watch-list/">
            List of materials to study
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/certs/" class="dd-item haschildren
        ">
      <div>
      <a href="/certs/">Certifications</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/certs/jncix-sp/" class="dd-item">
        <div>
          <a href="/certs/jncix-sp/">
            JNCIx-SP
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/igps/" class="dd-item haschildren
        ">
      <div>
      <a href="/igps/">IGPs</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/igps/isis/" class="dd-item haschildren
        ">
      <div>
      <a href="/igps/isis/">ISIS</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/igps/isis/isis/" class="dd-item">
        <div>
          <a href="/igps/isis/isis/">
            Integrated IS-IS notes
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/igps/ospf/" class="dd-item haschildren
        ">
      <div>
      <a href="/igps/ospf/">OSPF</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/igps/ospf/adj_formation/" class="dd-item">
        <div>
          <a href="/igps/ospf/adj_formation/">
            OSPF adj. formation notes
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/igps/ospf/troubleshooting/" class="dd-item">
        <div>
          <a href="/igps/ospf/troubleshooting/">
            OSPF troubleshooting
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/mpls-vpns/" class="dd-item haschildren
        ">
      <div>
      <a href="/mpls-vpns/">MPLS VPNs</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/mpls-vpns/vpls/" class="dd-item">
        <div>
          <a href="/mpls-vpns/vpls/">
            VPLS
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/multicast/" class="dd-item haschildren
        ">
      <div>
      <a href="/multicast/">Multicast</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/multicast/igmp/" class="dd-item">
        <div>
          <a href="/multicast/igmp/">
            IGMP
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/netops/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/netops/">Netops</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/netops/ansible/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/netops/ansible/">Ansible</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/netops/ansible/working-with-timestamp/" class="dd-item">
        <div>
          <a href="/netops/ansible/working-with-timestamp/">
            Ansible timestamps
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/netops/ansible/tricks/" class="dd-item">
        <div>
          <a href="/netops/ansible/tricks/">
            Ansible tips, tricks and notes
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/netops/ansible/ansible-w-junos/" class="dd-item">
        <div>
          <a href="/netops/ansible/ansible-w-junos/">
            Junos/Ansible basics
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/netops/ansible/network-engine/" class="dd-item active">
        <div>
          <a href="/netops/ansible/network-engine/">
            Network-engine module
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/netops/git/" class="dd-item haschildren
        ">
      <div>
      <a href="/netops/git/">GIT</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/netops/git/panic_buttons/" class="dd-item">
        <div>
          <a href="/netops/git/panic_buttons/">
            Git Panic Commands
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/netops/python/" class="dd-item haschildren
        ">
      <div>
      <a href="/netops/python/">Python</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/netops/python/python-virtualenvs/" class="dd-item">
        <div>
          <a href="/netops/python/python-virtualenvs/">
            Python Virtual Enviroments
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/netops/python/python-basics/" class="dd-item">
        <div>
          <a href="/netops/python/python-basics/">
            Python basics
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/netops/python/openpyxl/" class="dd-item">
        <div>
          <a href="/netops/python/openpyxl/">
            Working with Excel in Python
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/vendors/" class="dd-item haschildren
        ">
      <div>
      <a href="/vendors/">Vendor specifics</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/vendors/iosxe_cli/" class="dd-item">
        <div>
          <a href="/vendors/iosxe_cli/">
            IOS-XE CLI
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/vendors/junos_cli/" class="dd-item">
        <div>
          <a href="/vendors/junos_cli/">
            Junos CLI
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>




    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/ipspace-course-notes/" >
   Building Network Automation Solutions Course Notes</option>
    <option value="/certs/" >
   Certifications</option>
    <option value="/igps/" >
   IGPs</option>
    <option value="/mpls-vpns/" >
   MPLS VPNs</option>
    <option value="/multicast/" >
   Multicast</option>
    <option value="/netops/" >
   Netops</option> 
    <option value="/netops/ansible/" >
   Ansible</option> 
      <option value="/netops/ansible/working-with-timestamp/" > Ansible timestamps</option>
      <option value="/netops/ansible/tricks/" > Ansible tips, tricks and notes</option>
      <option value="/netops/ansible/ansible-w-junos/" > Junos/Ansible basics</option>
      <option value="/netops/ansible/network-engine/"  selected> Network-engine module</option>
  
    <option value="/netops/git/" >
   GIT</option>
    <option value="/netops/python/" >
   Python</option>
  
    <option value="/vendors/" >
   Vendor specifics</option>



        </select>
      </center>
    </div>
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="Search...">
        </div>
        <script type="text/javascript" src="/js/lunr.min.js"></script>
        <script type="text/javascript" src="/js/auto-complete.js"></script>
        <link href="/css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "\/";
          
        </script>
        <script type="text/javascript" src="/js/search.js"></script>
      </div>
    

    <h1>Network-engine module</h1>
    
    
    
    <pre><code>    1 	---
    2 	 - name: Parser role
    3 	   hosts: ios
    4 	   roles:
    5 	     - &quot;ansible-network.network-engine&quot;
    6 	   tasks:
    7 	    - name: &quot;Get router configuration&quot;
    8 	      ios_command:
    9 	        commands: &quot;show running-config | section ^vrf_definition&quot;
   10 	      register: vrf_config
   11 	
   12 	    - name: DEBUG1
   13 	      debug:
   14 	       var: vrf_config.stdout[0]
   15 	
   16 	    - name: &quot;Parse RT data&quot;
   17 	      command_parser:
   18 	        file: &quot;parsers/vrf.yml&quot;
   19 	        content: &quot;{{ vrf_config.stdout[0] }}&quot;
   20 	    
   21 	    - name: DEBUG2
   22 	      debug:
   23 	       msg: &quot;TEST {{item}}&quot;
   24 	      loop: &quot;{{vrf_data | dictsort }}&quot;
   25 	
   26 	    
</code></pre>

<pre><code>    1 	---
    2 	 - name: &quot;Parser metadata&quot;
    3 	   parser_metadata:
    4 	     version: 1.0
    5 	     command: &quot;show running-config | section ^vrf definition&quot;
    6 	     network_os: ios
    7 	
    8 	 - name: &quot;Match each VRF&quot;
    9 	   pattern_match:
   10 	      regex: &quot;vrf\\s+definition&quot;
   11 	      match_all: true
   12 	      match_greedy: true
   13 	   register: vrf_list
   14 	  #  export: yes
   15 	
   16 	 - name: &quot;Match VRF components&quot;
   17 	   pattern_group:
   18 	
   19 	     - name: &quot;Parse VRF name&quot;
   20 	       pattern_match:
   21 	         regex: &quot;vrf\\s+definition\\s+(\\S+)&quot;
   22 	         content: &quot;{{ item }}&quot;
   23 	       register: name
   24 	
   25 	     - name: &quot;Parse imported RTs&quot;
   26 	       pattern_match:
   27 	         regex: &quot;route-target\\s+import\\s+(\\d+:\\d+)&quot;
   28 	         content: &quot;{{ item }}&quot;
   29 	         match_all: true
   30 	       register: rti_matches
   31 	
   32 	     - name: &quot;Parse exported RTs&quot;
   33 	       pattern_match:
   34 	         regex: &quot;route-target\\s+export\\s+(\\d+:\\d+)&quot;
   35 	         content: &quot;{{ item }}&quot;
   36 	         match_all: true
   37 	       register: rte_matches
   38 	
   39 	   loop: &quot;{{ vrf_list }}&quot;
   40 	   register: vrf_components
   41 	   #export: yes
   42 	
   43 	 - name: &quot;Create JSON structure&quot;
   44 	   json_template:
   45 	     template:
   46 	       - key: &quot;{{ item.name.matches[0] }}&quot;
   47 	         object:
   48 	          - key: route_import
   49 	            value: &quot;{{ item.rti_matches | map(attribute='matches') | list }}&quot;
   50 	          - key: route_export
   51 	            value: &quot;{{ item.rte_matches | map(attribute='matches') | list }}&quot;
   52 	   loop: &quot;{{ vrf_components }}&quot;
   53 	   export: true
   54 	   export_as: dict
   55 	   register: vrf_data
</code></pre>

<pre><code>    1 	cra@lablinux:~/workbench/network-engine tests$ ansible-playbook do_parsing.yml
    2 	
    3 	PLAY [Parser role] **************************************************************************************************************************************************************************************************************************************************
    4 	TASK [Get router configuration] *************************************************************************************************************************************************************************************************************************************ok: [CSR]
    5 	
    6 	TASK [DEBUG1] *******************************************************************************************************************************************************************************************************************************************************ok: [CSR] =&gt; {
    7 	    &quot;vrf_config.stdout[0]&quot;: &quot;vrf definition VPN-A\n rd 1.1.1.1:1\n route-target export 65000:1\n route-target export 65000:2\n route-target export 65000:5\n route-target import 65000:5\n route-target import 65000:7\nvrf definition VPN-B\n rd 1.1.1.1:2\n route-target export 65000:9\n route-target export 65000:7\n route-target export 65000:1\n route-target import 65000:22\n route-target import 65000:11&quot;
    8 	}
    9 	
   10 	TASK [Parse RT data] ************************************************************************************************************************************************************************************************************************************************ok: [CSR]
   11 	
   12 	TASK [DEBUG2] *******************************************************************************************************************************************************************************************************************************************************ok: [CSR] =&gt; (item=[u'VPN-A', {u'route_export': [u'65000:1', u'65000:2', u'65000:5'], u'route_import': [u'65000:5', u'65000:7']}]) =&gt; {
   13 	    &quot;msg&quot;: &quot;TEST [u'VPN-A', {u'route_export': [u'65000:1', u'65000:2', u'65000:5'], u'route_import': [u'65000:5', u'65000:7']}]&quot;
   14 	}
   15 	ok: [CSR] =&gt; (item=[u'VPN-B', {u'route_export': [u'65000:9', u'65000:7', u'65000:1'], u'route_import': [u'65000:22', u'65000:11']}]) =&gt; {
   16 	    &quot;msg&quot;: &quot;TEST [u'VPN-B', {u'route_export': [u'65000:9', u'65000:7', u'65000:1'], u'route_import': [u'65000:22', u'65000:11']}]&quot;
   17 	}
   18 	
   19 	PLAY RECAP **********************************************************************************************************************************************************************************************************************************************************CSR                        : ok=4    changed=0    unreachable=0    failed=0
   20 	
   21 	cra@lablinux:~/workbench/network-engine tests$
   22 
</code></pre>


    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/netops/ansible/ansible-w-junos/" title="Junos/Ansible basics"> <i class="fa fa-chevron-left"></i><label>Junos/Ansible basics</label></a>
    <a class="nav nav-next" href="/netops/ansible/working-with-timestamp/" title="Ansible timestamps" style="margin-right: 0px;"><label>Ansible timestamps</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

    
    <div class="date">
        <i class='fa fa-calendar'></i> Last update on 06/09/2019
    </div>
    

    
  </div>


	<div>


  
    Create a content/_footer.md file to customize the footer content
  



	</div>
</footer>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>



<script src="/theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>